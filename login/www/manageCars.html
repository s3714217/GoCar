<!DOCTYPE html>
<html lang = "en">
<head>
	<meta charset = "UTF-8"/>
	<title>manageCars.html</title>
	<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>
	<script src="../js/config.js"></script>
	<script src="../js/global.js"></script>
	
	<script>
		function parking(){
			db.collection("parking_location").get().then((snapshot) => {
				snapshot.docs.forEach(doc => {
					var listParkings1 = document.querySelector("#location");
					var listParkings2 = document.querySelector("#updateLocation");
					
					var option1 = document.createElement("option");
					var address1 = document.createElement("span");
					var option2 = document.createElement("option");
					var address2 = document.createElement("span");
					
					option1.setAttribute("data-id", doc.id);
					address1.textContent = doc.data().Address; 
					option1.setAttribute("value", doc.data().Address);
					
					option2.setAttribute("data-id", doc.id);
					address2.textContent = doc.data().Address; 
					option2.setAttribute("value", doc.data().Address);
					
					option1.appendChild(address1);
					option2.appendChild(address2);
					
					listParkings1.appendChild(option1);
					listParkings2.appendChild(option2);
				})
			})
		}
		
		function carAdd(){
			var txtCarID = document.getElementById("carID").value;
			var optCondtion = document.getElementById("condition").value;
			var optLeased = document.getElementById("leased").value;
			var txtModel = document.getElementById("model").value;
			var optlocation = document.getElementById("location").value;
			var txtRate = document.getElementById("rate").value;
			var optType = document.getElementById("type").value;
			
			var rateNum = parseInt(txtRate);
			
			if (rateNum < 10 || rateNum > 20){
				alert("Please enter a rate between 10 and 20");
				return
			}
			
			var isTrue;
			if (optLeased == "1"){
				isTrue = true;
			} else if (optLeased == "0"){
				isTrue = false;
			}
			
			if (txtCarID === "" || txtModel === "" || txtRate === ""){
				alert("Please enter a CarID, Model and Rate");
				return
			}
			
			db.collection("test_cars").doc(txtCarID).get()
				.then(function(doc){
					if (doc.exists){
						alert("Car ID already exists");
					} else {
						db.collection("test_cars").doc(txtCarID).set({
							condition: optCondtion,
							leased: isTrue,
							model: txtModel,
							parking_location: optlocation,
							rate: rateNum,
							vehicle_type: optType
						})
						alert("Car added sucessfully");
					}
				})
				.catch(function(error){
					console.log("error", error);
				});
		}
		
		function cars(){
			db.collection("test_cars").get().then((snapshot) => {
				snapshot.docs.forEach(doc => {
					var listCars1 = document.querySelector("#carsToRemove");
					var listCars2 = document.querySelector("#carsToUpdate");
					
					var option1 = document.createElement("option");
					var cars1 = document.createElement("span");
					var option2 = document.createElement("option");
					var cars2 = document.createElement("span");
					
					option1.setAttribute("data-id", doc.id);
					cars1.textContent = doc.id;
					option1.setAttribute("value", doc.id);
					
					option2.setAttribute("data-id", doc.id);
					cars2.textContent = doc.id;
					option2.setAttribute("value", doc.id);
					
					option1.appendChild(cars1);
					option2.appendChild(cars2);
					
					listCars1.appendChild(option1);
					listCars2.appendChild(option2);
				})
			})
		}
		
		function carUpdate(){
			var optCars = document.getElementById("carsToUpdate").value;
			var optCondtion = document.getElementById("updateCondition").value;
			var optLeased = document.getElementById("updateLeased").value;
			var txtModel = document.getElementById("updateModel").value;
			var optlocation = document.getElementById("updateLocation").value;
			var txtRate = document.getElementById("updateRate").value;
			var optType = document.getElementById("updateType").value;
			
			var rateNum = parseInt(txtRate);
			
			if (rateNum < 10 || rateNum > 20){
				alert("Please enter a rate between 10 and 20");
				return
			}
			
			var isTrue;
			if (optLeased == "1"){
				isTrue = true;
			} else if (optLeased == "0"){
				isTrue = false;
			}
			
			if (txtModel === "" || txtRate === ""){
				alert("Please enter a car Model and Rate");
				return
			}
			
			db.collection("test_cars").doc(optCars).update(
				{
					condition: optCondtion,
					leased: isTrue,
					model: txtModel,
					parking_location: optlocation,
					rate: rateNum,
					vehicle_type: optType
				})
			.then(function(){
				alert("Successfully updated document " + optCars);
			})
			.catch(function(error){
				alert("Error: updating document " + error);
			});
		}
		
		function carRemove(){
			var optCars = document.getElementById("carsToRemove").value;
			
			db.collection("test_cars").doc(optCars).delete()
				.then(function (){
					alert("Car " + optCars + " was sucessfully removed");
				})
				.catch(function(error){
					alert("Error: could not remove car " + error);
				});
		}
	</script>
</head>

<body onload = "parking(); cars()">
	<h1>Manage Cars</h1>
	
	<h2>Add Car</h2>
	
	<form action = "">
		<label>Car ID</label>
		<input type = "text" maxlength = "7" id = "carID"/>
		<br/>
		<br/>
		<label>Condition</label>
		<select id = "condition">
			<option value = "new">New</option>
			<option value = "good">Good</option>
			<option value = "bad">Bad</option>
			<option value = "need_service">Need Service</option>
			<option value = "in_service">In Service</option>
		</select>
		<br/>
		<br/>
		<label>Leased</label>
		<select id = "leased">
			<option value = "1">True</option>
			<option value = "0">False</option>
		</select>
		<br/>
		<br/>
		<label>Model</label>
		<input type = "text" id = "model"/>
		<br/>
		<br/>
		<label>Parking Location</label>
		<select id = "location">
		</select>
		<br/>
		<br/>
		<label>Rate (between 10 and 20)</label>
		<input type = "number" id = "rate" min = "10" max = "20"/>
		<br/>
		<br/>
		<label>Vehicle Type</label>
		<select id = "type">
			<option value = "sedan">Sedan</option>
			<option value = "suv">SUV</option>
			<option value = "minivan">Minivan</option>
		</select>
		<br/>
		<br/>
		<button type = "button" id = "addCar" onclick = "carAdd()">
			 Add Car
		</button>
	</form>
	
	<h2>Modify Car</h2>
	
	<form action = "">
		<label>Car ID</label>
		<select id = "carsToUpdate">
		</select>
		<br/>
		<br/>
		<label>Condition</label>
		<select id = "updateCondition">
			<option value = "new">New</option>
			<option value = "good">Good</option>
			<option value = "bad">Bad</option>
			<option value = "need_service">Need Service</option>
			<option value = "in_service">In Service</option>
		</select>
		<br/>
		<br/>
		<label>Leased</label>
		<select id = "updateLeased">
			<option value = "1">True</option>
			<option value = "0">False</option>
		</select>
		<br/>
		<br/>
		<label>Model</label>
		<input type = "text" id = "updateModel"/>
		<br/>
		<br/>
		<label>Parking Location</label>
		<select id = "updateLocation">
		</select>
		<br/>
		<br/>
		<label>Rate (between 10 and 20)</label>
		<input type = "number" id = "updateRate" min = "10" max = "20"/>
		<br/>
		<br/>
		<label>Vehicle Type</label>
		<select id = "updateType">
			<option value = "sedan">Sedan</option>
			<option value = "suv">SUV</option>
			<option value = "minivan">Minivan</option>
		</select>
		<br/>
		<br/>
		<button type = "button" id = "update" onclick = "carUpdate()">
			 Update Car
		</button>
	</form>
	
	<h2>Remove Car</h2>
	
	<form action = "">
		<label>Please select a car to remove</label>
		<select id = "carsToRemove">
		</select>
		
		<button type = "button" id = "remove" onclick = "carRemove()">
			 Remove Car
		</button>
	</form>
</body>
</html>