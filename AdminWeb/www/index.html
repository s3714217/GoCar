<!DOCTYPE html>
<html lang="en">

<head>
	<title>Login | GoCar</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!--CSS from Bootstrap v4.5.2-->
	<link rel="stylesheet" type="text/css" href="../style/bootstrap.css">

	<!--Self-defined CSS-->
	<link rel="stylesheet" type="text/css" href="../style/style.css">

	<!--Jquery links-->
	<script src="https://code.jquery.com/jquery-3.6.0.js"
		integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

	<!--Javascript from Bootstrap-->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.6.0/dist/umd/popper.min.js"
		integrity="sha384-KsvD1yqQ1/1+IA7gi3P0tyJcT3vR+NdBTt13hSJ2lnve8agRGXTTyNaBYmCR/Nwi" crossorigin="anonymous">
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js"
		integrity="sha384-nsg8ua9HAw1y0W1btsyWgBklPnCUAFLuTMS2G72MMONqmOymq585AcH49TLBQObG" crossorigin="anonymous">
	</script>

	<!--Firebase and Cloud Firestore libraries-->
	<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-firestore.js"></script>

	<!--Self-defined JS-->
	<script src="../js/config.js"></script>
	<script src="../js/global.js"></script>

	<script>
		function signIn() {
			var txtUsername = document.getElementById("username").value;
			var txtPassword = document.getElementById("password").value;

			// Validation for login credentials
			if (txtUsername === "") {
				document.getElementById('usernameEmpty').innerHTML = "Please enter a username";
				return
			}

			if (txtPassword === "") {
				document.getElementById('passwordEmpty').innerHTML = "Please enter a password";
				return
			}

			var emailRE = /^.+@gocar\.com$/;
			if (txtUsername.match(emailRE)) {

			} else {
				document.getElementById('usernameInvalid').innerHTML = "Please enter a valid username";
				return
			}

			var username = txtUsername;
			localStorage.setItem("username", username);
			var password = txtPassword;

			// Checks onto Cloud Firestore (database) and validate the login credentials
			db.collection("admins").doc(username).get()
				.then(function (doc) {
					if (doc.exists) {
						var getPassword = doc.data().password;
						if (password == getPassword) {
							window.location.replace("dashboard.html");
						} else {
							document.getElementById('passwordError').innerHTML = "Please enter a valid password";
						}
					} else {
						document.getElementById('usernameError').innerHTML = "Please enter an existing username";
					}
				})
				.catch(function (error) {
					console.log("error", error);
				});
		}

		function resetUsername() {
			var username;
			localStorage.setItem("username", username);
		}
	</script>
</head>

<body id="portalLogin" class="d-flex m-0 p-0 vh-100" onload="resetUsername()">
	<div class="container m-auto text-center">
		<div id="loginCard" class="card bg-secondary mx-auto rounded-lg">
			<img src="style/login_logo.svg" id="logo" class="card-img-top w-50 mx-auto mt-4" alt="GoCar Logo">

			<div class="card-body">
				<h1 class="card-title">Login</h1>

				<form action="">
					<div class="col-auto p-0">
						<label class="sr-only" for="username">Username</label>

						<div class="input-group border-0">
							<input type="text" class="form-control form-control-lg border-0" id="username"
								placeholder="Username">
						</div>

						<!--Error Messages for Username-->
						<p id="usernameEmpty" class="text-danger" role="alert"></p>
						<p id="usernameError" class="text-danger" role="alert"></p>
						<p id="usernameInvalid" class="text-danger" role="alert"></p>
					</div>

					<div class="col-auto mt-4 p-0">
						<label class="sr-only" for="password">Password</label>

						<div class="input-group border-0">
							<input type="password" class="form-control form-control-lg border-0" id="password"
								placeholder="Password">
						</div>

						<!--Error Messages for Password-->
						<p id="passwordEmpty" class="text-danger" role="alert"></p>
						<p id="passwordError" class="text-danger" role="alert"></p>
					</div>

					<button type="button" id="login" class="btn btn-primary btn-block btn-lg mt-5 border-0"
						onclick="signIn()">
						Login
					</button>
				</form>
			</div>
		</div>
	</div>

</body>

</html>